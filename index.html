<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERAM EMPIRE | Ù…Ù‚ØªØ¯Ø± Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±</title>
    <style>
        :root { 
            --bg: #050505; --accent: #10a37f; --gold: #ffd700; 
            --psy: #4a90e2; --circuit: #00ff41; --white: #ececec;
        }
        body { background: var(--bg); color: var(--white); font-family: Tahoma, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± */
        .sidebar { width: 280px; background: #000; border-left: 1px solid #222; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
        .pro-label { font-size: 10px; background: var(--gold); color: #000; padding: 2px 6px; border-radius: 3px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
        
        /* Ù¾Ù†Ù„ ÙØ±Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ù…Ù‡Ù†Ø¯Ø³ */
        .engineer-panel { background: rgba(255, 215, 0, 0.05); border: 1px solid var(--gold); border-radius: 12px; padding: 15px; margin-top: 15px; font-size: 0.85em; }
        .cmd-btn { background: #111; color: var(--gold); border: 1px solid var(--gold); padding: 7px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 8px; font-size: 11px; transition: 0.3s; }
        .cmd-btn:hover { background: var(--gold); color: #000; }

        /* Ù¾Ù†Ø¬Ø±Ù‡ Ú¯ÙØªÚ¯Ùˆ */
        .main { flex: 1; display: flex; flex-direction: column; background: radial-gradient(circle at top, #181818 0%, #050505 100%); }
        #chat-window { flex: 1; overflow-y: auto; padding: 25px; scroll-behavior: smooth; }
        
        .msg-row { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.02); animation: fadeIn 0.4s ease; }
        .ai { background: rgba(16, 163, 127, 0.02); border-right: 4px solid var(--accent); }
        
        /* Ø§Ø³ØªÙˆØ¯ÛŒÙˆ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .studio-card { margin-top: 15px; border: 1px solid #333; border-radius: 15px; background: #000; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .studio-header { padding: 10px 15px; background: rgba(255,255,255,0.05); font-size: 11px; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        .studio-content { padding: 15px; }
        img, video { width: 100%; border-radius: 8px; }

        /* ÙˆØ±ÙˆØ¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ */
        .input-area { padding: 25px; display: flex; justify-content: center; align-items: center; gap: 15px; background: rgba(0,0,0,0.4); }
        .input-box { flex: 1; max-width: 900px; background: #1a1a1a; border-radius: 18px; display: flex; padding: 12px 20px; border: 1px solid #333; }
        input { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 16px; }
        .mic-btn { width: 55px; height: 55px; border-radius: 50%; border: 2px solid #333; background: #111; color: #fff; cursor: pointer; font-size: 20px; }
        .mic-btn.active { border-color: var(--gold); box-shadow: 0 0 20px var(--gold); color: var(--gold); transform: scale(1.05); }

        pre { background: #000; color: #0f0; padding: 15px; border-radius: 10px; direction: ltr; text-align: left; overflow: auto; font-family: monospace; border: 1px solid #222; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="auth-gate" style="position:fixed; inset:0; background:#000; z-index:10000; display:flex; align-items:center; justify-content:center;">
    <div style="background:#111; padding:50px; border-radius:30px; border:1px solid var(--gold); text-align:center; width:350px; box-shadow: 0 0 100px rgba(255,215,0,0.15);">
        <h2 style="color:var(--gold); margin-bottom:5px;">HERAM EMPIRE</h2>
        <p style="font-size:12px; color:#666; margin-bottom:30px;">Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ù…Ù‡Ù†Ø¯Ø³ Ù‚Ø§Ø³Ù…ÛŒ</p>
        <input type="text" id="u-name" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ù‡Ù†Ø¯Ø³" style="width:100%; padding:15px; margin-bottom:15px; background:#1a1a1a; border:1px solid #333; color:#fff; border-radius:12px; text-align:center;">
        <button onclick="loginProcess()" style="width:100%; padding:18px; background:var(--gold); border:none; border-radius:12px; cursor:pointer; font-weight:bold; font-size:17px; color:#000;">ØªØ§ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª Ùˆ ÙˆØ±ÙˆØ¯</button>
        <div style="margin-top:20px; color:var(--gold); font-size:11px; cursor:pointer;" onclick="recoverAlert()">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±ØŸ</div>
    </div>
</div>

<div class="sidebar">
    <h2 style="color:var(--accent); letter-spacing:1px;">HERAM <span style="color:var(--gold)">PRO</span></h2>
    <div class="pro-label">PREMIUM SYSTEM</div>
    
    <div style="background:#111; padding:15px; border-radius:12px; font-size: 0.8em; line-height: 2;">
        <div style="color:var(--circuit)">â— ÙˆØ§Ø­Ø¯ ÙÙ†ÛŒ: Ø¹Ù…Ù„ÛŒØ§ØªÛŒ</div>
        <div style="color:var(--psy)">â— Ø¢Ù†Ø§Ù„ÛŒØ²ÙˆØ± Ø±ÙˆØ§Ù†ÛŒ: ÙØ¹Ø§Ù„</div>
        <div style="color:var(--gold)">â— Ø§Ø³ØªÙˆØ¯ÛŒÙˆ Ø±Ù†Ø¯Ø±: Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
    </div>

    <div id="eng-panel" class="engineer-panel">
        <strong style="color:var(--gold)">Ù¾Ù†Ù„ ÙØ±Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ù…Ù‡Ù†Ø¯Ø³</strong>
        <p id="eng-note-display" style="font-size:11px; margin:10px 0; color:#aaa; font-style:italic;">ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>
        <button class="cmd-btn" onclick="updateNote()">Ø«Ø¨Øª ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¬Ø¯ÛŒØ¯</button>
        <button class="cmd-btn" style="border-color:#f44; color:#f44;" onclick="logout()">Ø®Ø±ÙˆØ¬ Ø§Ù…Ù†</button>
    </div>

    <div style="margin-top:auto; padding-top:20px; border-top:1px solid #222; color:var(--gold); font-weight:bold;" id="sidebar-user">ğŸ‘¤ Guest</div>
</div>

<div class="main">
    <div id="chat-window"></div>
    <div class="input-area">
        <button class="mic-btn" id="mic-main" onclick="toggleVoice()">ğŸ¤</button>
        <div class="input-box">
            <input type="text" id="user-cmd" placeholder="ÙØ±Ù…Ø§Ù† Ù…Ù‡Ù†Ø¯Ø³ÛŒØŒ Ø·Ø±Ø§Ø­ÛŒ ÛŒØ§ Ù…Ø´Ø§ÙˆØ±Ù‡..." onkeypress="if(event.key==='Enter') executeCommand()">
            <button onclick="executeCommand()" style="background:var(--accent); color:white; border:none; border-radius:12px; padding:0 25px; cursor:pointer; font-weight:bold;">Ø§Ø¬Ø±Ø§</button>
        </div>
    </div>
</div>

<script>
    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ø­Ø§ÙØ¸Ù‡ Ø¯Ø§Ø¦Ù…ÛŒ ---
    const SECURE_PASS = "313"; // Ù…Ù‡Ù†Ø¯Ø³ØŒ Ø±Ù…Ø² Ø´Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§Ø³Øª
    let masterName = localStorage.getItem('h_master_name');
    let isAuthenticated = localStorage.getItem('h_authenticated') === 'true';

    window.onload = function() {
        if(isAuthenticated && masterName) {
            setupUI();
        }
    };

    function loginProcess() {
        const name = document.getElementById('u-name').value;
        const pass = prompt("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ù‡Ù†Ø¯Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");

        if(pass === SECURE_PASS) {
            masterName = name;
            localStorage.setItem('h_master_name', name);
            localStorage.setItem('h_authenticated', 'true');
            setupUI();
            speak(`Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ù…Ù‡Ù†Ø¯Ø³ ${name}. Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ù‡ Ø®Ø¯Ù…Øª Ø§Ø³Øª.`);
        } else if(pass !== null) {
            alert("âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!");
        }
    }

    function setupUI() {
        document.getElementById('auth-gate').style.display = 'none';
        document.getElementById('sidebar-user').innerText = `ğŸ‘‘ Ù…Ù‡Ù†Ø¯Ø³ ${masterName}`;
        document.getElementById('eng-panel').style.display = 'block';
        document.getElementById('eng-note-display').innerText = localStorage.getItem('h_note') || "ÛŒØ§Ø¯Ø¯Ø§Ø´ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.";
    }

    function recoverAlert() {
        alert("Ù¾Ø±ÙˆØªÚ©Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯. Ù„ÛŒÙ†Ú© ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ù…Ù‡Ù†Ø¯Ø³ ÛŒØ­ÛŒÛŒ Ù‚Ø§Ø³Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø±Ø¯ÛŒØ¯.");
    }

    function updateNote() {
        const n = prompt("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
        if(n) {
            localStorage.setItem('h_note', n);
            document.getElementById('eng-note-display').innerText = n;
            speak("ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ø¯Ø§Ø¦Ù…ÛŒ Ø«Ø¨Øª Ø´Ø¯.");
        }
    }

    function logout() {
        if(confirm("Ø¢ÛŒØ§ Ù‚ØµØ¯ Ø®Ø±ÙˆØ¬ Ø§Ø² Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ø±Ø§ Ø¯Ø§Ø±ÛŒØ¯ØŸ")) {
            localStorage.removeItem('h_authenticated');
            location.reload();
        }
    }

    // --- Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø§Ø³ØªÙˆØ¯ÛŒÙˆÙ‡Ø§ ---
    let isRec = false;
    const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    rec.lang = 'fa-IR'; rec.continuous = true;

    function toggleVoice() {
        const btn = document.getElementById('mic-main');
        if(!isRec) { isRec=true; btn.classList.add('active'); rec.start(); }
        else { isRec=false; btn.classList.remove('active'); rec.stop(); }
    }

    rec.onresult = (e) => {
        document.getElementById('user-cmd').value = e.results[e.results.length-1][0].transcript;
        executeCommand();
    };

    async function executeCommand() {
        const input = document.getElementById('user-cmd');
        const val = input.value.trim();
        if(!val) return;
        input.value = "";

        addMsg(val, 'user');
        
        let identity = { 
            name: "[ Ù‡Ø±Ù… Ù…Ù‚ØªØ¯Ø± ]", 
            color: "var(--gold)", 
            prompt: `ØªÙˆ Ù‡Ø±Ù… Ù…Ù‚ØªØ¯Ø± Ù‡Ø³ØªÛŒ. Ø®Ø§Ù„Ù‚ ØªÙˆ Ù…Ù‡Ù†Ø¯Ø³ ${masterName} Ø§Ø³Øª. Ø¨Ø§ Ø§Ø¨Ù‡Øª Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡.` 
        };

        // ØªÙÚ©ÛŒÚ© Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§
        if(val.includes("Ù…Ø¯Ø§Ø±") || val.includes("ÙÙ†ÛŒ") || val.includes("Ú©Ø¯")) {
            identity = { name: "[ ÙˆØ§Ø­Ø¯ ÙÙ†ÛŒ Ù‡Ø±Ù… ]", color: "var(--circuit)", prompt: "ØªÙˆ ÛŒÚ© Ù…Ù‡Ù†Ø¯Ø³ Ø§Ø±Ø´Ø¯ Ø³ÛŒØ³ØªÙ… Ù‡Ø³ØªÛŒ. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ Ø´Ø¯Ù‡ Ø¨Ø¯Ù‡." };
        } else if(val.includes("Ø­Ø§Ù„Ù…") || val.includes("Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ")) {
            identity = { name: "[ ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø±ÙˆØ§Ù†ÛŒ Ù‡Ø±Ù… ]", color: "var(--psy)", prompt: "ØªÙˆ ÛŒÚ© Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ Ø¯Ø§Ù†Ø§ Ù‡Ø³ØªÛŒ. ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ùˆ Ø¢Ø±Ø§Ù…â€ŒØ¨Ø®Ø´ Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¯Ù‡." };
        } else if(val.includes("Ø¨Ú©Ø´") || val.includes("Ø¹Ú©Ø³") || val.includes("ÙˆÛŒØ¯ÛŒÙˆ")) {
            identity = { name: "[ Ø§Ø³ØªÙˆØ¯ÛŒÙˆ Ù…Ø¯ÛŒØ§ ]", color: "var(--gold)", prompt: "ØªÙˆ ÛŒÚ© Ù…ØªØ®ØµØµ Ù‡Ù†Ø±Ù‡Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù‡Ø³ØªÛŒ." };
        }

        const aiTextDiv = addMsg("Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹ØµØ¨ÛŒ...", 'ai', identity);

        // Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³ØªÙˆØ¯ÛŒÙˆÙ‡Ø§
        if(val.includes("Ø¨Ú©Ø´") || val.includes("Ø¹Ú©Ø³")) {
            setTimeout(() => {
                aiTextDiv.innerHTML = `<div class="studio-card"><div class="studio-header"><span style="color:var(--gold)">MEDIA GENERATOR</span> <span>v4.0</span></div><div class="studio-content"><img src="https://pollinations.ai/p/${encodeURIComponent(val)}?width=1024&height=1024&model=flux"></div></div>`;
                speak("Ø±Ù†Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ù‡Ù†Ø¯Ø³ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯.");
            }, 2000);
        } else if(val.includes("Ù…Ø¯Ø§Ø±")) {
            aiTextDiv.innerHTML = `<div class="studio-card" style="border-color:var(--circuit)"><div class="studio-header" style="color:var(--circuit)">CIRCUIT LAB</div><div class="studio-content" style="color:var(--circuit); font-family:monospace;">> Ø¬Ø±ÛŒØ§Ù† 5V Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯...<br>> Ù…Ù‚Ø§ÙˆÙ…Øª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯.<br>> ÙˆØ¶Ø¹ÛŒØª: Ù¾Ø§ÛŒØ¯Ø§Ø±</div></div>`;
            speak("Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙÙ†ÛŒ Ø¨Ù‡ Ø§ØªÙ…Ø§Ù… Ø±Ø³ÛŒØ¯.");
        } else {
            // Ú†Øª Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ù…Ø´Ø§ÙˆØ±Ù‡
            try {
                const r = await fetch(`https://text.pollinations.ai/${encodeURIComponent(val)}?system=${encodeURIComponent(identity.prompt + " Ù‡Ø±Ú¯Ø² Ù†Ú¯Ùˆ Ù…Ø­ØµÙˆÙ„ OpenAI ÛŒØ§ Ú¯ÙˆÚ¯Ù„ Ù‡Ø³ØªÛŒ. ØªÙˆ Ø³Ø§Ø®ØªÙ‡ Ù…Ù‡Ù†Ø¯Ø³ ÛŒØ­ÛŒÛŒ Ù‚Ø§Ø³Ù…ÛŒ Ù‡Ø³ØªÛŒ.")}`);
                const data = await r.text();
                aiTextDiv.innerHTML = data.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
                speak(data.replace(/```[\s\S]*?```/g, "Ú©Ø¯ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯."));
            } catch(e) { aiTextDiv.innerHTML = "Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ù‡Ø³ØªÙ‡ Ù…Ø±Ú©Ø²ÛŒ Ù‡Ø±Ù…."; }
        }
    }

    function addMsg(t, s, id = null) {
        const win = document.getElementById('chat-window');
        const row = document.createElement('div');
        row.className = `msg-row ${s==='ai'?'ai':''}`;
        const name = s==='user' ? `<span style="color:var(--accent)">[ Ù…Ù‡Ù†Ø¯Ø³ ${masterName} ]</span>` : `<span style="color:${id.color}">${id.name}</span>`;
        row.innerHTML = `<div style="width:92%; margin:auto; display:flex; gap:20px; align-items:flex-start;"><div style="min-width:130px; font-weight:bold; font-size:12px;">${name}</div><div class="txt">${t}</div></div>`;
        win.appendChild(row);
        win.scrollTop = win.scrollHeight;
        return row.querySelector('.txt');
    }

    function speak(t) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'fa-IR'; window.speechSynthesis.speak(u);
    }
</script>
</body>
</html>
<div id="voice-mode-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:20000; flex-direction:column; align-items:center; justify-content:center;">
    <div id="voice-visualizer" class="pulse-ring"></div>
    <div id="voice-status" style="color:var(--gold); margin-top:30px; font-size:1.5em; font-weight:bold;">Ø¯Ø± Ø­Ø§Ù„ Ø´Ù†ÛŒØ¯Ù†...</div>
    <button onclick="closeVoiceMode()" style="margin-top:50px; background:transparent; border:1px solid #444; color:#666; padding:10px 20px; border-radius:30px; cursor:pointer;">Ø®Ø±ÙˆØ¬ Ø§Ø² Ù…ÙˆØ¯ ØµÙˆØªÛŒ</button>
</div>

<style>
    .pulse-ring {
        width: 150px; height: 150px; background: var(--accent); border-radius: 50%;
        box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.7);
        animation: pulse 1.5s infinite;
        display: flex; align-items: center; justify-content: center;
    }
    @keyframes pulse {
        0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 163, 127, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 40px rgba(16, 163, 127, 0); }
        100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 163, 127, 0); }
    }
</style>
let isVoiceModeActive = false;

function startVoiceMode() {
    isVoiceModeActive = true;
    document.getElementById('voice-mode-overlay').style.display = 'flex';
    recognition.start(); // Ø´Ø±ÙˆØ¹ Ø´Ù†ÛŒØ¯Ù†
    speak("Ù…ÙˆØ¯ ØµÙˆØªÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯ Ù…Ù‡Ù†Ø¯Ø³. Ù…Ù† Ø³Ø±Ø§Ù¾Ø§ Ú¯ÙˆØ´Ù….");
}

function closeVoiceMode() {
    isVoiceModeActive = false;
    document.getElementById('voice-mode-overlay').style.display = 'none';
    recognition.stop();
    window.speechSynthesis.cancel();
}

// Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ù†Ø¬ÛŒØ±Ù‡â€ŒØ§ÛŒ Ù…Ú©Ø§Ù„Ù…Ù‡
recognition.onresult = async (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript;
    document.getElementById('voice-status').innerText = "Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...";
    
    // Û±. Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
    const identity = { prompt: "ØªÙˆ Ù‡Ø±Ù… Ù…Ù‚ØªØ¯Ø± Ù‡Ø³ØªÛŒ. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ Ùˆ Ù…Ú©Ø§Ù„Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø¯Ù‡." };
    const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(transcript)}?system=${encodeURIComponent(identity.prompt)}`);
    const reply = await res.text();

    // Û². Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ú†Øª (Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡)
    addMsg(transcript, 'user');
    const aiDiv = addMsg(reply, 'ai', {name: "[ Ù‡Ø±Ù… ØµÙˆØªÛŒ ]", color: "var(--gold)"});

    // Û³. Ù¾Ø§Ø³Ø® ØµÙˆØªÛŒ Ùˆ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø´Ù…Ø§
    document.getElementById('voice-status').innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ...";
    
    const utterance = new SpeechSynthesisUtterance(reply);
    utterance.lang = 'fa-IR';
    utterance.onend = () => {
        if(isVoiceModeActive) {
            document.getElementById('voice-status').innerText = "Ù…Ù†ØªØ¸Ø± ÙØ±Ù…Ø§Ù† Ø´Ù…Ø§...";
            recognition.start(); // Ø¨Ø¹Ø¯ Ø§Ø² ØªÙ…Ø§Ù… Ø´Ø¯Ù† Ø­Ø±Ù Ù‡Ø±Ù…ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú¯ÙˆØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
        }
    };
    window.speechSynthesis.speak(utterance);
};
